# 1. 教程简介

## 将会学到什么

1. 搭建思路
2. 熟悉dify工作流
3. dify自定义工具
4. dify内调用飞书api


## 流程图


# 2. 准备工作

## 2.1 添加 internlm 2.5 模型 
进入硅基流动官网：https://cloud.siliconflow.cn/s/internlm

点击“API密钥”复制密钥 
![复制密钥](https://github.com/user-attachments/assets/6e31de94-c3e7-46ac-a651-e748dd3ca2d7)

点击“头像”，点击“设置”,“模型供应商”里选择“SILICONFLOW”,点击“设置”，填入api key,模型列表可以看到internlm 2.5
![设置1](https://github.com/user-attachments/assets/8a83bb6d-ad60-4df0-9715-e1254dd3ae9e)
![设置2](https://github.com/user-attachments/assets/5aa9331d-955d-45b4-9ca9-c4f6cf045c21)
![设置3](https://github.com/user-attachments/assets/235927bb-7035-4f44-b71c-aadb7f2e83f3)
![设置4](https://github.com/user-attachments/assets/7053ce1c-1b92-4817-861e-2a7323ec644d)

# 2.2 创建工作流

“创建空白应用”----“工作流”

![创建工作流](https://github.com/user-attachments/assets/edce4ab1-2d3a-47af-8f7e-90e0597addec)

# 2.3 飞书多维表格建立

可以根据自己的需求，进行修改。以下仅个人在设计字段时的一些思路。

**2.3.1 表格设计前思考为什么要收藏这篇文章**

① 属于什么领域，属于什么性质（科普、纯技术、实操....），什么阶段（初级、中级、进阶....）等等......

② 文章传递的什么，如：解决什么问题？提出什么观点？介绍什么新技术？让你觉得值得细看的点在于？等等......

③ 别人推荐的，但是现在没空细看，先收录一下

**2.3.2 表格设计**

```字段说明```如下：

| 字段名     | 飞书字段类型 | 字段说明                                                                 |
|------------|---------------|--------------------------------------------------------------------------|
| 标题       | 文本        | 标题                                                                     |
| 链接       | 文本        | 分享的链接，点击即可跳转阅读                                               |
| 摘要       | 文本        | 通篇大概讲了什么，可以由爬虫插件生成                              |
| 来源       | 单选        | 来自哪个平台，如：b站、小红书、网站等等。后续如果扩展做数据统计时可作为一项分类指标   |
| 形式   | 单选         | 展现形式：图文（纯文也归到这类）、视频                                                                |
| tag       | 多选         | 按领域、功能等做一个划分，也可以称它为某个合集，比如产品、AI、大模型等                    |
| 状态       | 单选         | 已阅读、未阅读                                                             |
| 收集日期   | 文本        | 写入表格日期，因为飞书时间格式和插件时间格式有出入，我太懒了不想做处理，直接设置文本型 |
| 收藏原因   | 文本        | 为什么要收录这篇                                                          |
| 读后感     | 文本        | 读后感                                                                   |
| 价值等级   | 单选        | 这篇文章含金量怎么样，可自己设置值，比如：低、中、高                          |

![空表示例](https://github.com/user-attachments/assets/9ddd717f-fc23-4a8c-91d0-b7346436fb26)

**2.3.3 关于分享链接**

**整理出自己常看平台的分享链接**

比如我常看的平台分享链接如下，可以看出有些平台分享链接需要做一个提取```https链接```处理的。

```小红书分享链接```：

```
93 【大连｜4天21顿❣️人少嘎嘎好吃，本地人推荐‼️ - 马溜达 | 小红书 - 你的生活指南】 😆 lR3gT9A0eAQ5XWn 😆 https://www.xiaohongshu.com/discovery/item/667aacb8000000001e010eb2?source=webshare&xsec_token=AB1e31D0BGnaywnmwX7C37dGKIbrOsxGltreE-BRB1aeE=&xsec_source=pc_share
```

```知乎分享链接```：

```
手搓一个最小的 Agent 系统 — Tiny Agent - RedHerring的文章 - 知乎
https://zhuanlan.zhihu.com/p/699732624
```

```抖音分享链接```：

```
9.99 Eus:/ 12/21 J@i.Ch 大连千万级博主总结的大连旅游注意事项，看这一个就足够足够了 # 大连旅游攻略 # 大连 # 大连美食   https://v.douyin.com/iksNQqte/ 复制此链接，打开Dou音搜索，直接观看视频！
```

```公众号文章分享链接```：

```
https://mp.weixin.qq.com/s/d8mvSU77l_xAHKo3gqyPGQ
```

```B站分享链接```：

```
【SOLIDWORKS 教学 精品教程 | 2024年新修 | B站 点赞 播放 收藏 NO.1】 https://www.bilibili.com/video/BV1iw411Z7HZ/?share_source=copy_web&vd_source=93b749d0faa4f6da4b3a9891caf73e4d
```

```youtube分享链接```：

```
https://youtu.be/siHNmXLZ8y4?si=2KwcS5wElJBK4Eva
```

# 3. 搭建工作流

之前已经在coze搭建并跑通，coze的教程是一边设计一边写的，dify这边直接拿已跑通的思路来写。

## 3.1 定义输入变量

根据表格来看，我们要新增的输入变量分别有```链接```、```形式```、```tag```、```收藏原因```。

![变量分类](https://github.com/user-attachments/assets/d7fad01a-d455-4c40-a4d8-10e32a35f08c)

判断是否要进行链接提取，我们需要加一个boolean值的变量作为判断。

![新增变量](https://github.com/user-attachments/assets/d0775e71-8ef1-4ea7-8e75-abe0c3a833a3)

![handle变量配置](https://github.com/user-attachments/assets/8ee83cb5-66e4-405a-83c0-f6fcd830562c)


## 3.2 添加通用变量-时间

![添加时间工具](https://github.com/user-attachments/assets/f948baf3-6fda-4a9c-84b7-006a5e21211c)

## 3.3 判断形式-图文or视频

注意：事先我们规定好genre（形式）只能是图文 或 视频。

添加```条件分支```，判断是```图文```还是```视频```。如果更严谨点，可以加一个```ELIF```是"图文"。

![条件分支](https://github.com/user-attachments/assets/c5675773-a8c5-4f9c-ba30-12ce0e6a2eb0)

## 3.4 视频类收藏处理

### 3.4.1 判断是否要进行链接处理

对于分享链接内包含文字（通常是标题）：
1. 取出url地址
2. 取出标题

对于只有url地址的：
1. 输出url地址
2. 根据reason（收藏理由）提炼出标题
   
```

```


## 3.5 图文类收藏处理

